<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>å½°åŒ–ç¾é£Ÿåœ°åœ– TOP20 - çˆŒè‚‰é£¯ã€è‚‰åœ“ã€ç´ é£Ÿéºµ</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00804b">

<style>
/* åŸºç¤è¨­å®š */
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,"Microsoft JhengHei",sans-serif;background:#f5f5f5;color:#333;line-height:1.6}
.container{max-width:1000px;margin:0 auto;padding:1rem}

/* å°èˆªåˆ—æ¨£å¼ */
nav{background:#00804b;padding:0.8rem 0;box-shadow:0 2px 10px rgba(0,0,0,0.2)}
nav .container{display:flex;justify-content:space-between;align-items:center;padding-top:0;padding-bottom:0;}
nav h1{font-size:1.4rem;color:#fff;margin:0;}
nav a{color:#fff;text-decoration:none;padding:0.5rem 1rem;border-radius:6px;transition:background 0.3s;}
nav a:hover{background:rgba(255,255,255,0.2);}

/* æ§åˆ¶å€æ¨£å¼ */
.controls{background:#fff;padding:1rem;border-radius:14px;box-shadow:0 4px 20px rgba(0,0,0,.1);margin-bottom:1rem;text-align:center}
.control-group{margin-bottom:0.8rem;}
label{font-weight:bold;margin:0 .4rem}
select,input{padding:.6rem 1rem;border:1px solid #bbb;border-radius:10px;font-size:1rem;margin:.3rem;max-width:200px;vertical-align:middle;}

/* æŒ‰éˆ•æ¨£å¼ ã€ä¿®æ­£å€ã€‘ */
.category-buttons{
  display:flex;
  justify-content:flex-start; /* ä¿æŒé å·¦å°é½Š */
  gap:10px;
  margin-top:10px;
  /* ç§»é™¤ flex-wrap: wrap; */
  overflow-x: auto; /* å…è¨±æ°´å¹³æ»‘å‹• */
  padding: 5px 0; /* è®“æ»‘å‹•æ¢æœ‰ç©ºé–“ */
  white-space: nowrap; /* å¼·åˆ¶ä¸æ›è¡Œ */
  -webkit-overflow-scrolling: touch; /* iOS é †æš¢æ»‘å‹• */
}

.category-buttons button{
  flex-shrink: 0; /* ã€é—œéµã€‘é˜²æ­¢æŒ‰éˆ•è¢«å£“ç¸® */
  padding:0.7rem 1.2rem;border-radius:10px;font-size:1rem;cursor:pointer;
  border:none;background:#ccc;color:#333;transition:background 0.3s, transform 0.1s;
}
.category-buttons button.active{
  background:#00804b;color:#fff;box-shadow:0 4px 10px rgba(0,128,75,0.4);
}
.category-buttons button:active{transform:scale(0.98);}

/* å¡ç‰‡åˆ—è¡¨æ¨£å¼ */
#cards{display:grid;grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));gap:20px;padding-top:10px;}
.card{background:#fff;padding:1.5rem;border-radius:14px;box-shadow:0 4px 10px rgba(0,0,0,0.05);transition:transform 0.2s;}
.card:hover{transform:translateY(-3px);box-shadow:0 6px 15px rgba(0,0,0,0.1);}
.card h2{font-size:1.3rem;margin-bottom:1rem;color:#00804b;border-bottom:2px solid #eee;padding-bottom:10px;}
.card .item{margin-bottom:0.5rem;font-size:1rem;}
.card b{font-weight:600;color:#333;display:inline-block;min-width:70px;}

/* ç°¡ä»‹æ¨£å¼ */
.card .description {
    font-size: 0.95rem;
    color: #555;
    margin-bottom: 10px;
    padding: 5px 0 10px 0;
    border-bottom: 1px dashed #eee;
    font-style: italic; 
}
.card .description b {
    font-weight: bold;
    color: #000;
}

/* è©•åˆ†å’Œé€£çµæ¨£å¼ */
.score{font-weight:bold;padding:2px 8px;border-radius:4px;color:#fff;display:inline-block;min-width:50px;text-align:center;}
.score.high{background:#4CAF50;} /* >= 4.5 ç¶ è‰² */
.score.mid{background:#FFC107;color:#333;} /* >= 4.0 é»ƒè‰² */
.score.low{background:#F44336;} /* < 4.0 ç´…è‰² */
.phone-link a{color:#007bff;text-decoration:none;font-weight:bold;}
.map-link a{display:inline-block;background:#00804b;color:#fff;padding:8px 15px;border-radius:8px;text-decoration:none;margin-top:5px;transition:background 0.3s;}
.map-link a:hover{background:#00663d;}

/* é—œæ–¼å€å¡Š */
#about{background:#e0f7e0;padding:2rem;border-radius:14px;box-shadow:0 4px 10px rgba(0,0,0,0.05);margin-top:20px;}
#about h2{color:#00804b;margin-bottom:1rem;}

/* ç„¡çµæœæç¤º */
#no-results{text-align:center;font-size:1.2rem;color:#999;padding:40px 0;grid-column:1 / -1;}
</style>
</head>
<body>

<nav id="top-nav">
  <div class="container">
    <h1>å½°åŒ–ç¾é£Ÿåœ°åœ–</h1>
    <div>
      <a href="#controls">ç¯©é¸</a>
      <a href="#about">é—œæ–¼</a>
    </div>
  </div>
</nav>

<div class="container">

  <section id="controls" class="controls">
    <h2>ğŸ¯ ç¾é£Ÿç¯©é¸èˆ‡æœå°‹</h2>
    <div class="control-group">
      <label for="districtFilter">åœ°å€ï¼š</label>
      <select id="districtFilter">
        <option value="">å…¨éƒ¨åœ°å€</option>
      </select>
    </div>
    <div class="control-group">
      <label for="keywordInput">æœå°‹ï¼š</label>
      <input type="text" id="keywordInput" placeholder="è¼¸å…¥åº—åã€ç‰¹è‰²æˆ–åœ°å€">
    </div>
    <div class="category-buttons">
      <button data-cat="" class="active">å…¨éƒ¨ç¾é£Ÿ</button>
      <button data-cat="kongroufan">çˆŒè‚‰é£¯</button>
      <button data-cat="rouyuan">è‚‰åœ“</button>
      <button data-cat="sushi">ç´ é£Ÿéºµ</button>
    </div>
  </section>

  <div id="cards">
    </div>

  <section id="about">
    <h2>é—œæ–¼æ­¤å°ˆæ¡ˆ</h2>
    <p>æœ¬ç¾é£Ÿåœ°åœ–å°ˆæ¡ˆç‚º PWA (Progressive Web App) ç¯„ä¾‹ï¼Œè³‡æ–™æ¡ç”¨å½°åŒ–åœ°å€ä¸‰ç¨®åœ¨åœ°ç‰¹è‰²å°åƒï¼šçˆŒè‚‰é£¯ã€è‚‰åœ“ã€ç´ é£Ÿéºµã€‚æ‰€æœ‰è³‡æ–™çš†ç‚ºäººå·¥æ•´ç†ï¼Œæ—¨åœ¨æä¾›ä¸€å€‹å¿«é€Ÿã€å¯é›¢ç·šå­˜å–ã€ä¸”åŠŸèƒ½å®Œæ•´çš„è¡Œå‹•ç«¯ç¾é£Ÿå°è¦½é«”é©—ã€‚</p>
    <p>è³‡æ–™ç¯„åœï¼šå…± 105 ç­†åœ¨åœ°åº—å®¶ï¼Œæ¶µè“‹å½°åŒ–å¸‚ã€å“¡æ—å¸‚ã€é¹¿æ¸¯é®ã€åŒ—æ–—é®ç­‰é‡è¦é„‰é®ã€‚è³‡æ–™ä¾†æºç‚º Google Maps è©•è«–å¹³å‡åˆ†æ•¸ï¼Œä¸¦å–åˆ†æ•¸æœ€é«˜çš„ TOP20 é€²è¡Œé¡¯ç¤ºã€‚</p>
  </section>

</div>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js').then(registration => {
        console.log('Service Worker registered: ', registration);
      }).catch(err => {
        console.log('Service Worker registration failed: ', err);
      });
    });
  }
</script>

<script src="data.js"></script>
<script>
const districtFilter = document.getElementById("districtFilter");
const keywordInput = document.getElementById("keywordInput");
let currentCategory = "";

// ä½¿ç”¨ data è®Šæ•¸ï¼Œèˆ‡ data.js ä¿æŒä¸€è‡´
// å¡«å……åœ°å€ç¯©é¸å™¨é¸é …
const districtSet = new Set(data.map(x => x.district));
districtSet.forEach(d => {
  const opt = document.createElement("option");
  opt.value = d;
  opt.textContent = d;
  districtFilter.appendChild(opt);
});

// æ¨¡ç³Šæœå°‹å·¥å…·å‡½å¼
function fuzzyMatch(text, keyword) {
    if (!text || !keyword) return false;
    text = text.toLowerCase();
    keyword = keyword.toLowerCase();
    return text.includes(keyword);
}

// å‡½å¼é˜²æŠ– (Debounce)
function debounce(func, delay) {
    let timeoutId;
    return function(...args) {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => {
            func.apply(this, args);
        }, delay);
    };
}

function render() {
  const district = districtFilter.value;
  const category = currentCategory;
  const keyword = keywordInput.value;

  // ä½¿ç”¨ä¿®æ­£å¾Œçš„ data è®Šæ•¸
  let list = data.slice(); 

  // 1. ä¾åœ°å€ç¯©é¸
  if (district) list = list.filter(i => i.district === district);

  // 2. ä¾é¡åˆ¥ç¯©é¸
  if (category) list = list.filter(i => i.category === category);

  // 3. æ¨¡ç³Šæœå°‹ (å¤šæ¬„ä½)
  if (keyword) {
    list = list.filter(i =>
      fuzzyMatch(i.name, keyword) ||
      fuzzyMatch(i.dish, keyword) ||
      fuzzyMatch(i.address, keyword) ||
      fuzzyMatch(i.feature, keyword) ||
      fuzzyMatch(i.description, keyword)
    );
  }

  // 4. æ’åº TOP20
  list = list.sort((a, b) => b.google - a.google).slice(0, 20);

  const box = document.getElementById("cards");
  box.innerHTML = "";

  if (list.length === 0) {
    box.innerHTML = `<div id="no-results">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„åº—å®¶ï¼</div>`;
    return;
  }

  list.forEach((i, idx) => {
    // åœ°åœ–é€£çµä¿®æ­£
    const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(i.name + " " + i.address)}`;

    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <h2>${idx + 1}. ${i.name}</h2>
      
      <div class="item description"><b>ç°¡ä»‹ï¼š</b>${i.description || 'æš«ç„¡è©³ç´°ç°¡ä»‹'}</div> 
      
      <div class="item"><b>åœ°å€ï¼š</b>${i.district}</div>
      <div class="item"><b>Google è©•åˆ†ï¼š</b><span class="score ${i.google >= 4.5 ? 'high' : i.google >= 4.0 ? 'mid' : 'low'}">${i.google}</span></div>
      <div class="item"><b>æ‹›ç‰Œï¼š</b>${i.dish}</div>
      <div class="item"><b>ç‰¹è‰²ï¼š</b>${i.feature}</div> 
      <div class="item"><b>æ™‚æ®µï¼š</b>${i.time}</div>
      <div class="item"><b>åƒ¹æ ¼ï¼š</b>${i.price}</div>
      <div class="item phone-link"><b>é›»è©±ï¼š</b><a href="tel:${i.phone}">${i.phone}</a></div>
      <div class="item map-link">
        <a href="${mapUrl}" target="_blank">ğŸ“ æŸ¥çœ‹åœ°åœ–èˆ‡å°èˆª</a>
      </div>
    `;

    box.appendChild(card);
  });
}

// äº‹ä»¶ç›£è½å™¨
document.querySelectorAll(".category-buttons button").forEach(btn => {
  btn.addEventListener("click", () => {
    // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„ active ç‹€æ…‹
    document.querySelectorAll(".category-buttons button").forEach(b => b.classList.remove('active'));
    // ç‚ºé»æ“Šçš„æŒ‰éˆ•æ–°å¢ active ç‹€æ…‹
    btn.classList.add('active');
    currentCategory = btn.dataset.cat;
    render();
  });
});

districtFilter.addEventListener("change", render);
// æ‡‰ç”¨ Debounce åˆ°æœå°‹æ¡†è¼¸å…¥äº‹ä»¶
keywordInput.addEventListener("input", debounce(render, 300));

// åˆå§‹åŒ–æ¸²æŸ“
render();
</script>

</body>
</html>
