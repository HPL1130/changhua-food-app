<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>å½°åŒ–ç¾é£Ÿåœ°åœ– TOP - çˆŒè‚‰é£¯ã€è‚‰åœ“ã€ç´ é£Ÿéºµ</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00804b">

<style>
/* åŸºç¤è¨­å®š */
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,"Microsoft JhengHei",sans-serif;background:#f5f5f5;color:#333;line-height:1.6}
.container{max-width:1000px;margin:0 auto;padding:1rem}

/* å°èˆªåˆ—æ¨£å¼ */
nav{background:#00804b;padding:0.8rem 0;box-shadow:0 2px 10px rgba(0,0,0,0.2)}
nav .container{display:flex;justify-content:space-between;align-items:center;padding-top:0;padding-bottom:0;}
nav h1{font-size:1.4rem;color:#fff;margin:0;}
nav a{color:#fff;text-decoration:none;padding:0.5rem 1rem;border-radius:6px;transition:background 0.3s;}
nav a:hover{background:rgba(255,255,255,0.2);}

/* æ§åˆ¶å€æ¨£å¼ */
.controls{background:#fff;padding:1rem;border-radius:14px;box-shadow:0 4px 20px rgba(0,0,0,.1);margin-bottom:1rem;text-align:center}
.control-group{margin-bottom:0.8rem;}
label{font-weight:bold;margin:0 .4rem}
select,input{padding:.6rem 1rem;border:1px solid #bbb;border-radius:10px;font-size:1rem;margin:.3rem;max-width:200px;vertical-align:middle;}

/* æŒ‰éˆ•æ¨£å¼ */
.category-buttons{
  display:flex;
  justify-content:flex-start; /* ä¿æŒé å·¦å°é½Š */
  gap:10px;
  margin-top:10px;
  overflow-x: auto; /* å…è¨±æ°´å¹³æ»‘å‹• */
  padding: 5px 0; /* è®“æ»‘å‹•æ¢æœ‰ç©ºé–“ */
  white-space: nowrap; /* å¼·åˆ¶ä¸æ›è¡Œ */
  -webkit-overflow-scrolling: touch; /* iOS é †æš¢æ»‘å‹• */
}

.category-buttons button{
  flex-shrink: 0; /* é˜²æ­¢æŒ‰éˆ•è¢«å£“ç¸® */
  padding:0.7rem 1.2rem;border-radius:10px;font-size:1rem;cursor:pointer;
  border:none;background:#ccc;color:#333;transition:background 0.3s, transform 0.1s;
}
.category-buttons button.active{
  background:#00804b;color:#fff;box-shadow:0 4px 10px rgba(0,128,75,0.4);
}
.category-buttons button:active{transform:scale(0.98);}

/* å¡ç‰‡åˆ—è¡¨æ¨£å¼ */
#cards{display:grid;grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));gap:20px;padding-top:10px;}
.card{background:#fff;padding:1.5rem;border-radius:14px;box-shadow:0 4px 10px rgba(0,0,0,0.05);transition:transform 0.2s;}
.card:hover{transform:translateY(-3px);box-shadow:0 6px 15px rgba(0,0,0,0.1);}
.card h2{font-size:1.3rem;margin-bottom:1rem;color:#00804b;border-bottom:2px solid #eee;padding-bottom:10px;}
.card .item{margin-bottom:0.5rem;font-size:1rem;}
.card b{font-weight:600;color:#333;display:inline-block;min-width:70px;}

/* ç°¡ä»‹æ¨£å¼ */
.card .description {
    font-size: 0.95rem;
    color: #555;
    margin-bottom: 10px;
    padding: 5px 0 10px 0;
    border-bottom: 1px dashed #eee;
    font-style: italic; 
}
.card .description b {
    font-weight: bold;
    color: #000;
}

/* è©•åˆ†å’Œé€£çµæ¨£å¼ */
.score{font-weight:bold;padding:2px 8px;border-radius:4px;color:#fff;display:inline-block;min-width:50px;text-align:center;}
.score.high{background:#4CAF50;} /* >= 4.5 ç¶ è‰² */
.score.mid{background:#FFC107;color:#333;} /* >= 4.0 é»ƒè‰² */
.score.low{background:#F44336;} /* < 4.0 ç´…è‰² */
.phone-link a{color:#007bff;text-decoration:none;font-weight:bold;}
.map-link a{display:inline-block;background:#00804b;color:#fff;padding:8px 15px;border-radius:8px;text-decoration:none;margin-top:5px;transition:background 0.3s;}
.map-link a:hover{background:#00663d;}

/* é—œæ–¼å€å¡Š */
#about{background:#e0f7e0;padding:2rem;border-radius:14px;box-shadow:0 4px 10px rgba(0,0,0,0.05);margin-top:20px;}
#about h2{color:#00804b;margin-bottom:1rem;}

/* ç„¡çµæœæç¤º */
#no-results{text-align:center;font-size:1.2rem;color:#999;padding:40px 0;grid-column:1 / -1;}

/* ã€å„ªåŒ–ã€‘åˆ†é æ¨£å¼ - ç¢ºä¿ç½®ä¸­ */
#pagination {
    text-align: center; 
    padding: 20px 0;
    margin-top: 20px;
    display: flex; 
    justify-content: center; /* ç¢ºä¿åˆ†é æ§åˆ¶é …ç½®ä¸­ */
    align-items: center;
}
#pagination button {
    padding: 10px 20px; 
    border-radius: 8px; 
    border: none;
    background: #00804b;
    color: #fff;
    font-size: 1rem;
    cursor: pointer;
    transition: background 0.3s;
    min-width: 100px;
}
#pagination button:disabled {
    background: #ccc;
    cursor: not-allowed;
}
#pageInfo {
    font-size: 1.1rem; 
    font-weight: bold; 
    color: #333;
    margin: 0 15px;
}
</style>
</head>
<body>

<nav id="top-nav">
  <div class="container">
    <h1>å½°åŒ–ç¾é£Ÿåœ°åœ–</h1>
    <div>
      <a href="#controls">ç¯©é¸</a>
      <a href="#about">é—œæ–¼</a>
    </div>
  </div>
</nav>

<div class="container">

  <section id="controls" class="controls">
    <h2>ğŸ¯ ç¾é£Ÿç¯©é¸èˆ‡æœå°‹</h2>
    <div class="control-group">
      <label for="districtFilter">åœ°å€ï¼š</label>
      <select id="districtFilter">
        <option value="">å…¨éƒ¨åœ°å€</option>
      </select>
    </div>
    <div class="control-group">
      <label for="keywordInput">æœå°‹ï¼š</label>
      <input type="text" id="keywordInput" placeholder="è¼¸å…¥åº—åã€ç‰¹è‰²æˆ–åœ°å€">
    </div>
    <div class="category-buttons">
      <button data-cat="" class="active">å…¨éƒ¨ç¾é£Ÿ</button>
      <button data-cat="kongroufan">çˆŒè‚‰é£¯</button>
      <button data-cat="rouyuan">è‚‰åœ“</button>
      <button data-cat="sushi">ç´ é£Ÿéºµ</button>
    </div>
  </section>
  
  <h2 id="resultCount" style="text-align: center; margin: 10px 0; color: #00804b;"></h2>

  <div id="cards">
    </div>

  <div id="pagination">
      <button id="prevBtn" disabled>ä¸Šä¸€é </button>
      <span id="pageInfo">ç¬¬ 1 é  / å…± ? é </span>
      <button id="nextBtn">ä¸‹ä¸€é </button>
  </div>
  <section id="about">
    <h2>é—œæ–¼æ­¤å°ˆæ¡ˆ</h2>
    <p>æœ¬ç¾é£Ÿåœ°åœ–å°ˆæ¡ˆç‚º PWA (Progressive Web App) ç¯„ä¾‹ï¼Œè³‡æ–™æ¡ç”¨å½°åŒ–åœ°å€ä¸‰ç¨®åœ¨åœ°ç‰¹è‰²å°åƒï¼šçˆŒè‚‰é£¯ã€è‚‰åœ“ã€ç´ é£Ÿéºµã€‚æ‰€æœ‰è³‡æ–™çš†ç‚ºäººå·¥æ•´ç†ï¼Œæ—¨åœ¨æä¾›ä¸€å€‹å¿«é€Ÿã€å¯é›¢ç·šå­˜å–ã€ä¸”åŠŸèƒ½å®Œæ•´çš„è¡Œå‹•ç«¯ç¾é£Ÿå°è¦½é«”é©—ã€‚</p>
    <p>è³‡æ–™ç¯„åœï¼šç¸½è¨ˆç´„ 91 ç­†åœ¨åœ°åº—å®¶ (ç´ é£Ÿéºµ 23ã€çˆŒè‚‰é£¯ 42ã€è‚‰åœ“ 26)ï¼Œæ¶µè“‹å½°åŒ–å¸‚ã€å“¡æ—å¸‚ã€é¹¿æ¸¯é®ã€åŒ—æ–—é®ç­‰é‡è¦é„‰é®ã€‚è³‡æ–™ä¾†æºç‚º Google Maps è©•è«–å¹³å‡åˆ†æ•¸ï¼Œä¸¦ä»¥åˆ†æ•¸é«˜ä½æ’åºå¾Œï¼Œåˆ†é é¡¯ç¤ºã€‚</p>
  </section>

</div>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js').then(registration => {
        console.log('Service Worker registered: ', registration);
      }).catch(err => {
        console.log('Service Worker registration failed: ', err);
      });
    });
  }
</script>

<script src="data.js"></script>
<script>
const districtFilter = document.getElementById("districtFilter");
const keywordInput = document.getElementById("keywordInput");
let currentCategory = "";

// åˆ†é è®Šæ•¸
let currentPage = 1;
const itemsPerPage = 20; // æ¯é é¡¯ç¤º 20 ç­†

// ã€å„ªåŒ–ã€‘å®šç¾©æœ‰é †åºçš„åœ°å€åˆ—è¡¨
const DISTRICT_ORDER = [
  "å½°åŒ–å¸‚", "å“¡æ—å¸‚", "é¹¿æ¸¯é®", "åŒ—æ–—é®", "ç§€æ°´é„‰", "èŠ±å£‡é„‰", 
  "å’Œç¾é®", "åŸ”å¿ƒé„‰", "æºªæ¹–é®", "äºŒæ°´é„‰", "èŠ¬åœ’é„‰", "æ°¸é–é„‰", 
  "ç”°ä¸­é®", "å¤§æ‘é„‰", "åŸ¤é ­é„‰"
];

// å¡«å……åœ°å€ç¯©é¸å™¨é¸é …
function populateDistrictFilter() {
    // å–å¾—è³‡æ–™ä¸­çš„æ‰€æœ‰åœ°å€
    const dataDistricts = new Set(data.map(x => x.district));
    
    // æ¸…ç©ºç¾æœ‰é¸é … (é™¤äº† "å…¨éƒ¨åœ°å€")
    while (districtFilter.options.length > 1) {
        districtFilter.remove(1);
    }
    
    // ä¾å®šç¾©å¥½çš„é †åºåŠ å…¥é¸é …
    DISTRICT_ORDER.forEach(d => {
        if (dataDistricts.has(d)) {
            const opt = document.createElement("option");
            opt.value = d;
            opt.textContent = d;
            districtFilter.appendChild(opt);
            dataDistricts.delete(d); // å¾é›†åˆä¸­ç§»é™¤å·²è™•ç†çš„åœ°å€
        }
    });

    // åŠ å…¥ DISTRICT_ORDER ä»¥å¤–çš„åœ°å€ (ä»¥é˜²è³‡æ–™æœ‰æ–°çš„é„‰é®)
    dataDistricts.forEach(d => {
        const opt = document.createElement("option");
        opt.value = d;
        opt.textContent = d;
        districtFilter.appendChild(opt);
    });
}

// æ¨¡ç³Šæœå°‹å·¥å…·å‡½å¼
function fuzzyMatch(text, keyword) {
    if (!text || !keyword) return false;
    text = text.toLowerCase();
    keyword = keyword.toLowerCase();
    return text.includes(keyword);
}

// å‡½å¼é˜²æŠ– (Debounce)
function debounce(func, delay) {
    let timeoutId;
    return function(...args) {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => {
            func.apply(this, args);
        }, delay);
    };
}

function render() {
  const district = districtFilter.value;
  const category = currentCategory;
  const keyword = keywordInput.value;
  const cardsBox = document.getElementById("cards");
  const paginationBox = document.getElementById("pagination");
  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");
  const pageInfo = document.getElementById("pageInfo");
  const resultCount = document.getElementById("resultCount"); // ã€å„ªåŒ–ã€‘çµæœè¨ˆæ•¸å…ƒç´ 

  // 1. ç¯©é¸
  let list = data.slice(); 

  if (district) list = list.filter(i => i.district === district);
  if (category) list = list.filter(i => i.category === category);

  if (keyword) {
    list = list.filter(i =>
      fuzzyMatch(i.name, keyword) ||
      fuzzyMatch(i.dish, keyword) ||
      fuzzyMatch(i.address, keyword) ||
      fuzzyMatch(i.feature, keyword) ||
      // ã€å„ªåŒ–ã€‘ç°¡ä»‹å…§å®¹ä¹Ÿç´å…¥æ¨¡ç³Šæœå°‹
      fuzzyMatch(i.description, keyword)
    );
  }

  // 2. æ’åº (ä¾ Google è©•åˆ†é«˜åˆ°ä½)
  list = list.sort((a, b) => b.google - a.google);
  
  // 3. ã€åˆ†é é‚è¼¯ã€‘è¨ˆç®—ç¸½é æ•¸èˆ‡ä¿®æ­£ç•¶å‰é ç¢¼
  const totalItems = list.length;
  const totalPages = Math.ceil(totalItems / itemsPerPage);

  // ç¢ºä¿ç•¶å‰é ç¢¼åœ¨æœ‰æ•ˆç¯„åœå…§
  if (currentPage > totalPages && totalPages > 0) {
      currentPage = totalPages;
  } else if (totalPages === 0) {
      currentPage = 1;
  } else if (currentPage < 1) {
      currentPage = 1;
  }
  
  // å–å¾—ç•¶å‰é é¢çš„è³‡æ–™
  const start = (currentPage - 1) * itemsPerPage;
  const end = start + itemsPerPage;
  const pagedList = list.slice(start, end);

  // 4. æ¸²æŸ“å¡ç‰‡
  cardsBox.innerHTML = "";
  resultCount.textContent = `æ‰¾åˆ° ${totalItems} ç­†çµæœ`; // ã€å„ªåŒ–ã€‘æ›´æ–°çµæœç¸½æ•¸

  if (totalItems === 0) {
    cardsBox.innerHTML = `<div id="no-results">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„åº—å®¶ï¼</div>`;
    paginationBox.style.display = 'none'; // ç„¡çµæœæ™‚éš±è—åˆ†é æ§åˆ¶
    return;
  }
  
  paginationBox.style.display = 'flex'; // é¡¯ç¤ºåˆ†é æ§åˆ¶

  pagedList.forEach((i, idx) => {
    // å…¨å±€ç·¨è™Ÿ (ä¾‹å¦‚: ç¬¬ 2 é çš„ç¬¬ 5 ç­†ï¼Œç·¨è™Ÿç‚º 20+5=25)
    const globalIdx = start + idx + 1; 

    // ã€å„ªåŒ–ã€‘ä¿®æ­£ Google Maps é€£çµæ ¼å¼
    const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(i.name + " " + i.address)}`;

    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <h2>${globalIdx}. ${i.name}</h2>
      
      <div class="item description"><b>ç°¡ä»‹ï¼š</b>${(i.description ? i.description.trim() : 'æš«ç„¡è©³ç´°ç°¡ä»‹')}</div> 
      
      <div class="item"><b>åœ°å€ï¼š</b>${i.district}</div>
      <div class="item"><b>Google è©•åˆ†ï¼š</b><span class="score ${i.google >= 4.5 ? 'high' : i.google >= 4.0 ? 'mid' : 'low'}">${i.google}</span></div>
      <div class="item"><b>æ‹›ç‰Œï¼š</b>${i.dish}</div>
      <div class="item"><b>ç‰¹è‰²ï¼š</b>${i.feature}</div> <div class="item"><b>æ™‚æ®µï¼š</b>${i.time}</div> <div class="item"><b>åƒ¹æ ¼ï¼š</b>${i.price}</div> <div class="item phone-link"><b>é›»è©±ï¼š</b><a href="tel:${i.phone}">${i.phone}</a></div>
      <div class="item map-link">
        <a href="${mapUrl}" target="_blank">ğŸ“ æŸ¥çœ‹åœ°åœ–èˆ‡å°èˆª</a>
      </div>
    `;

    cardsBox.appendChild(card);
  });
  
  // 5. ã€åˆ†é æ§åˆ¶æ›´æ–°ã€‘
  prevBtn.disabled = currentPage === 1;
  nextBtn.disabled = currentPage === totalPages || totalPages === 0;
  pageInfo.textContent = `ç¬¬ ${currentPage} é  / å…± ${totalPages} é  (å…± ${totalItems} ç­†)`;
}

// äº‹ä»¶ç›£è½å™¨ï¼šåˆ‡æ›ç¯©é¸æ¢ä»¶æ™‚ï¼Œé‡è¨­é ç¢¼ç‚º 1
document.querySelectorAll(".category-buttons button").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".category-buttons button").forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentCategory = btn.dataset.cat;
    currentPage = 1; // é‡è¨­é ç¢¼
    render();
  });
});

districtFilter.addEventListener("change", () => {
    currentPage = 1; // é‡è¨­é ç¢¼
    render();
});

// æ‡‰ç”¨ Debounce åˆ°æœå°‹æ¡†è¼¸å…¥äº‹ä»¶ï¼Œä¸¦é‡è¨­é ç¢¼
keywordInput.addEventListener("input", debounce(() => {
    currentPage = 1; // é‡è¨­é ç¢¼
    render();
}, 300));


// ä¸Šä¸€é /ä¸‹ä¸€é æŒ‰éˆ•äº‹ä»¶
document.addEventListener("DOMContentLoaded", () => {
    populateDistrictFilter(); // ã€å„ªåŒ–ã€‘ç¶²é åŠ è¼‰æ™‚ï¼Œä½¿ç”¨å®šç¾©çš„é †åºå¡«å……åœ°å€ç¯©é¸å™¨
    
    document.getElementById("prevBtn").addEventListener("click", () => {
        if (currentPage > 1) {
            currentPage--;
            render();
            // æ²å‹•åˆ°é ‚éƒ¨ (å°èˆªåˆ—ä¸‹æ–¹)
            document.getElementById('top-nav').scrollIntoView({ behavior: 'smooth' });
        }
    });

    document.getElementById("nextBtn").addEventListener("click", () => {
        currentPage++;
        render();
        // æ²å‹•åˆ°é ‚éƒ¨ (å°èˆªåˆ—ä¸‹æ–¹)
        document.getElementById('top-nav').scrollIntoView({ behavior: 'smooth' });
    });
    
    // åˆå§‹åŒ–æ¸²æŸ“
    render();
});
</script>

</body>
</html>
