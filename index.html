<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>彰化真食記 v9.0 - 免費動態版</title>
  <link rel="manifest" href="data:application/manifest+json,{
    \"name\":\"彰化真食記\",\"short_name\":\"彰化食記\",
    \"start_url\":\".\",\"display\":\"standalone\",
    \"background_color\":\"#fafafa\",\"theme_color\":\"#d4380d\"
  }">
  <style>
    body{font-family:system-ui;margin:0;padding:10px;background:#fafafa;line-height:1.6}
    .header{background:linear-gradient(135deg,#d4380d,#a21c00);color:white;padding:20px;border-radius:12px;margin-bottom:12px;text-align:center}
    .controls{display:flex;flex-wrap:wrap;gap:10px;padding:12px;background:white;border-radius:12px;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);align-items:center}
    .btn{padding:12px 18px;border:none;border-radius:25px;cursor:pointer;font-weight:bold;background:#eee}
    .btn.active{background:#d4380d;color:white}
    input,select{padding:12px 16px;border:1.5px solid #ddd;border-radius:25px;width:100%;font-size:1rem}
    .list{list-style:none;padding:0;max-height:68vh;overflow-y:auto}
    .item{background:white;margin:10px 0;padding:16px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1)}
    .item h3{margin:0 0 8px;color:#d4380d;font-size:1.15rem}
    .map-btn{background:#1a73e8;color:white;padding:7px 14px;border:none;border-radius:6px;cursor:pointer;margin-top:8px}
    .edit-btn{background:#28a745;color:white;padding:10px 16px;border:none;border-radius:25px;cursor:pointer;font-size:0.9rem}
    #noData, #loading{text-align:center;padding:50px;color:#999;font-style:italic}
    @media (max-width:600px){.controls{flex-direction:column}}
  </style>
</head>
<body>
  <div class="header">
    <h1>彰化真食記 v9.0</h1>
    <p>免費動態更新｜GitHub 驅動｜<a href="https://github.com/HPL1130/changhua-food-data" target="_blank" style="color:#fff;text-decoration:underline">編輯資料</a></p>
  </div>
  <div class="controls">
    <button class="btn active" onclick="switchCategory('kongroufan')">爌肉飯</button>
    <button class="btn" onclick="switchCategory('rouyuan')">肉圓</button>
    <button class="btn" onclick="switchCategory('sushi')">素食麵</button>
    <input type="text" id="search" placeholder="搜店名/地址/特色..." oninput="filterData()">
    <select id="district" onchange="filterData()">
      <option value="">所有行政區</option>
    </select>
    <a href="https://github.com/HPL1130/changhua-food-data/edit/main/data.json" target="_blank" class="edit-btn">編輯資料</a>
  </div>
  <div id="loading">載入中...</div>
  <ul id="list" class="list"></ul>
  <div id="noData">請選擇分類或輸入關鍵字</div>

  <script>
    const DATA_URL = 'https://raw.githubusercontent.com/HPL1130/changhua-food-data/main/data.json';
    let data = [], filteredData = [], currentCategory = 'kongroufan';

    // 內建備用資料（離線用）
    const fallbackData = [ /* 上面 95 筆資料已內嵌 */ ];

    async function loadData() {
      document.getElementById('loading').style.display = 'block';
      try {
        const res = await fetch(DATA_URL + '?t=' + Date.now());
        if (res.ok) data = await res.json();
        else throw '';
      } catch { data = fallbackData; }
      init();
      document.getElementById('loading').style.display = 'none';
    }

    function init() {
      const districts = [...new Set(data.map(i => i.district))].sort();
      const select = document.getElementById('district');
      districts.forEach(d => {
        const opt = document.createElement('option');
        opt.value = d; opt.textContent = d;
        select.appendChild(opt);
      });
      filterData();
    }

    function switchCategory(cat) {
      currentCategory = cat;
      document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
      filterData();
    }

    function filterData() {
      const query = document.getElementById('search').value.trim().toLowerCase();
      const district = document.getElementById('district').value;
      filteredData = data.filter(item =>
        item.category === currentCategory &&
        (!district || item.district === district) &&
        (!query || JSON.stringify(item).toLowerCase().includes(query))
      );
      renderList();
    }

    function renderList() {
      const list = document.getElementById('list');
      list.innerHTML = '';
      if (filteredData.length === 0) {
        document.getElementById('noData').style.display = 'block';
        return;
      }
      document.getElementById('noData').style.display = 'none';
      filteredData.forEach(item => {
        const li = document.createElement('li');
        li.className = 'item';
        li.innerHTML = `
          <h3>${item.name} <small style="color:#888">(${item.district})</small></h3>
          <p><strong>地址：</strong>${item.address.replace('彰化縣', '')}</p>
          <p><strong>電話：</strong>${item.phone}</p>
          <p><strong>特色：</strong>${item.feature}</p>
          <p><strong>推薦：</strong>${item.dish}</p>
          <p><strong>營業：</strong>${item.time}</p>
          <p><strong>價位：</strong>${item.price}</p>
          <p><strong>Google：</strong>${'★'.repeat(Math.round(item.google))} ${item.google}</p>
          <button class="map-btn" onclick="openMap('${item.address}')">導航</button>
        `;
        list.appendChild(li);
      });
    }

    function openMap(address) {
      window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}`, '_blank');
    }

    loadData();
  </script>
</body>
</html>
